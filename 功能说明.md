# Vouchap - 功能说明文档

## v2.0.2 版本新功能亮点

### 📷 智能图片处理（核心升级）
- **自动识别票据**：AI 自动识别拍摄画面中的票据区域
- **智能裁剪矫正**：自动裁剪并矫正票据图片，去除多余背景
- **质量提升**：归档的票据图片更清晰、更规整，提高后续识别准确率
- **清晰度评分**：自动评估小票图片的清晰度 (0-100%)
- **完整度评分**：检测小票是否被裁切或遮挡，图片质量不佳时提示重拍

### 📊 智能排序与匹配（核心升级）
- **使用频率排序**：分类、用途、支付账户、币种按使用频率自动排序，常用选项优先显示
- **智能默认值**：基于历史使用习惯，自动推荐最可能的分类和用途
- **币种记忆**：记录用户常用币种，自动设置默认货币
- **账户智能匹配**：根据卡号尾号自动匹配已有支付账户，避免重复创建

### 🏪 供应商信息增强
- **详细信息识别**：AI 自动识别供应商的税号、电话、地址等完整信息
- **供应商档案**：自动建立供应商档案，方便后续追溯和统计
- **智能匹配**：根据税号或名称自动匹配已有供应商，避免重复创建

### ✅ 数据一致性检查
- **金额校验**：自动检测明细金额总和是否与总金额匹配
- **缺失提醒**：识别可能遗漏的商品项并提示用户
- **重复数据校验**：重复拍摄的票据有明确标识，且自动不纳入统计
- **置信度调整**：根据数据一致性自动调整识别置信度

### 🔄 术语优化
- **Supplier（供应商）**：Store（商店）更名为 Supplier（供应商），以符合更丰富的场景
- **Space（空间）**：Household（家庭）更名为 Space（空间），支持更灵活丰富的场景

---

## 应用简介
Vouchap 是一款完全由 AI 开发的票据识别记账 App。它支持拍摄消费票据或通过 Chat 文字描述消费情况，并利用 **Google Gemini AI** 自动识别并整理成明细，帮助用户轻松管理日常开支。所有数据以空间（Space）为单位进行隔离，并加密存储在云端。

---

## 核心功能

### 1. 小票识别与录入
* **拍摄小票**：支持使用设备相机直接拍摄或从手机相册选择已有图片。
* **即时上传**：拍摄后自动上传至云端存储 (Supabase Storage)。
* **AI 智能识别**：使用 Google Gemini 1.5 Pro AI 模型自动识别店铺名称、消费日期、总金额、商品明细（名称、价格、数量）及支付账户。
* **置信度评估**：系统为每个识别结果提供置信度评分（0.00-1.00）。
* **智能确认与编辑**：
    * **低置信度提示**：识别置信度较低时，系统会提示用户确认信息。
    * **手动编辑**：用户可修正识别结果，包括修改商品名称、价格、调整分类、设置用途、标记资产及增删项。
* **手动录入**：
    * **Chat 录入**：支持文字 chat、语音转文字等方式输入购买信息。
    * **表单录入**：通过空表单手动填写店铺、日期、金额等信息。

### 2. 小票管理
* **小票列表**：
    * **时间分组**：按月份分组显示，支持折叠与展开。
    * **状态筛选**：支持待确认 (Pending)、处理中 (Processing)、已确认 (Confirmed)、需重拍 (Needs Retake) 及重复 (Duplicate)。
    * **搜索功能**：支持按店铺名称、金额等关键词搜索。
* **小票详情**：支持查看完整信息、原图、在线编辑商品、更新状态及删除小票。
* **数据统计**：提供月份统计（数量与总金额）及分类统计。

### 3. 空间管理（用于家庭、公司、组织的区隔）
* **创建空间**：新用户可创建新空间，设置名称（必填）和地址（可选）。
* **成员权限**：管理员可以编辑空间信息，所有成员均可查看基本信息。
* **切换空间**：支持多空间管理，用户可在管理页面快速切换或创建新空间。

### 4. 成员管理
* **信息展示**：显示成员邮箱、角色（管理员/普通成员）及最后登录时间。
* **邀请机制**：管理员通过邮箱邀请新成员。邀请状态分为待处理、已接受、已拒绝、已取消及已移除。
* **处理邀请**：首页以层叠卡片形式展示待处理邀请，支持接受、拒绝或稍后处理。

### 5. 分类、用途与账户管理
* **分类管理**：提供默认分类，支持自定义创建、编辑、删除（非默认）及合并分类。
* **用途管理**：定义商品用途（如个人、商务），支持自定义颜色标识及统计。
* **支付账户**：管理现金、信用卡等账户，支持 AI 自动识别匹配及账户合并。

---

## 技术特性
* **数据安全**：利用 Row Level Security (RLS) 实现空间数据隔离，确保用户只能访问所属空间的数据。
* **实时同步**：基于 Supabase Realtime 实现多设备数据实时同步。
* **离线支持**：关键数据本地缓存，网络错误时自动重试。
* **权限分配**：
    * **管理员**：编辑空间信息、邀请/移除成员、管理全部分类与账户。
    * **普通成员**：查看空间信息、创建/编辑小票、管理仅限自己创建的分类与账户。

---

## 注意事项
1. **网络需求**：首次使用和 AI 识别需要网络连接。
2. **存储空间**：小票图片占用云端存储，需注意定期清理。
3. **隐私保护**：系统不访问用户数据，仅空间成员可见。
4. **API 限制**：Gemini AI 有调用频率限制，请合理使用。

**最后更新：2026年1月30日 (v2.0.2)**
**联系反馈：** James (james.zjgao@gmail.com / 微信: James_aimlink)
